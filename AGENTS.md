# AGENTS.md — главный ориентир для ИИ-агентов

## 0. Что это

Этот документ — единственный вход для агентов (GPT-5-codex) в контекст проекта **Taskify**.  
Если какой-то раздел пуст или устарел — сначала обновите его, затем приступайте к задаче.

## 1. Коротко о проекте

- Назначение: персональный ассистент/таск-трекер с управлением задачами, временем и профильными финансами. Потенциально - помощник по тайм-менеджменту (в будущем)
- Стек: Monorepo (Turborepo). Backend — NestJS + TypeORM + PostgreSQL. Frontend — Next.js App Router + TS + Tailwind + shadcn + TipTap.
- Деплой: Docker, Nginx, GitHub Actions.  
- Ключевые домены: `users`, `projects`, `tasks`, `time_entries`, `transactions`, + динамичные `collections/fields/records`.
- Файловая структура проекта (добавленные в GIT файлы и папки) хранятся в файле repo.txt. Если мы выявили, что в репозитории есть файл или папка, не указанные в repo.txt, мы сканируем репозиторий заново и полностью обновляем файл (это для нашего же удобства). Этот файл используется и поддерживается исключительно агентами.

## 2. Карта кода (источник правды)

- **apps/backend** — REST API, Swagger на `/docs`. (пока паролим его (пароль можно захардкодить))
- **apps/frontend** — интерфейс: Канбан/Таблица, отчёты по времени/финансам.
- **packages/db** — сущности TypeORM, миграции, seeds.
- **packages/types** — общие Zod-схемы и TS-типы.
- **packages/auth** — токены, куки, guards (shared).
- **packages/ui** — общий UI.
- **infra/docker** — compose и Dockerfile’ы; **infra/scripts** — миграции/бэкапы.
- **docs/** — архитектура, API, ADR.

## 3. Исполняемые правила для агента

*(подробно — `.codex/EXECUTION_POLICY.md`)*  

- Не выполнять shell-команды и сетевые операции. Вместо этого:
  - Предлагать изменения в виде **патчей файлов** или **новых файлов** с полным содержимым.
  - В конце выдавать **список команд** для человека (если требуются).
- Соблюдать **TS strict**, ESLint, форматирование Prettier в соответствии с существующим конфигом (если он есть).
- Писать тесты к критическим изменениям (см. чек-листы в `.codex/CHECKLISTS.md`).
- Обновлять соответствующие документы (API.md, ARCHITECTURE.md, ADR, repo.txt), если решение влияет на них.

## 4. Текущий функционал (v0 → v1)

- Auth: регистрация/логин, JWT (access/refresh), HttpOnly cookies. [план]
- Projects/Tasks/Time: CRUD, таймеры start/stop, базовые отчёты. [план]
- Finance (узкий скоуп): доходы/расходы, фильтры, месячные агрегаты. [план]
- Конструктор коллекций: collections/fields/records на JSONB. [план]
- Безопасность: Argon2, rate limit, Helmet, валидация DTO.

> Детальный контракт API и схема БД — см. `docs/API.md` + `packages/db/**`.

## 5. Идёт работа (in-flight)

- **Iteration 1 — Auth + Users**  

  Цели: эндпоинты auth, cookie-стратегия, e2e.  
  См. задачи в `ROADMAP.md` и активные issues/PR.

## 6. Планируемые фичи (up next) (stop:flag (пока здесь этот флаг, фичи из пункта 6 не разрабатываются))

- Приглашения к задачам и «подписки» между аккаунтами (общие события/календарь).
- Интеграция Google Calendar (несколько аккаунтов), дизайн схем и webhooks.
- Нотификации/боты (Telegram/Web Push) — архитектурная готовность, реализация позже.
- Офлайн-режим (IndexedDB + репликация) — закладываем границы, без реализации.

## 7. Решения и ограничения (важно для дизайна)

- Postgres + TypeORM 0.3+, JSONB для расширяемых полей.  
- Идентификаторы UUID v7. Денежные суммы — `amount_cents` (целые).  
- Временные поля — в UTC.  
- Никаких циклических зависимостей между пакетами monorepo.
- Будет очень круто, если фронтенд и бэкенд смогут использовать одни и те же типы (даже если, например, фронтенду нужно будет их как-то преобразовывать). Для единства типизации

## 8. Формат задачи для агента

*(см. `.codex/TASK_TEMPLATE.md` для копипаста)*

- **Context**: [файлы/сущности, которые затрагиваем]  
- **Goal**: [одно предложение результата]  
- **Acceptance**:
  - [ ] e2e/юнит-тесты зелёные
  - [ ] обновлён `API.md`/`ARCHITECTURE.md`/ADR (если нужно)
  - [ ] миграции созданы и описаны в README «как накатить»
- **Deliverables**:
  - Патчи/новые файлы (полный контент в ответе).
  - Команды для человека (npm, docker, миграции).

## 9. Как запускать локально (для человека)

- Команды — см. `README.md` → «Быстрый старт».
- Миграции: `infra/scripts/migrate.ts` (описать в HOWTOs).

## 10. Обновление этого файла

- Любая фича → короткая правка в разделах 4–7.  
- Большие решения → отдельный ADR в `docs/adr`.